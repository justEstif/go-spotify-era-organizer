{{define "title"}}Your Eras - Spotify Era Organizer{{end}}

{{define "content"}}
<section class="eras-page">
    <header class="eras-header">
        <div class="eras-header__content">
            <h1 class="eras-header__title">Your Listening Eras</h1>
            <p class="eras-header__subtitle">
                {{if .Eras}}
                    {{len .Eras}} era{{if gt (len .Eras) 1}}s{{end}} discovered from your library
                {{else}}
                    No eras detected yet. Sync your library to get started.
                {{end}}
            </p>
        </div>
        <div class="eras-header__actions">
            <a href="/" class="btn btn-secondary">Back</a>
        </div>
    </header>

    {{if .Eras}}
    <div class="eras-grid">
        {{range .Eras}}
        <article class="era-card" data-era-id="{{.ID}}">
            <div class="era-card__header">
                <h2 class="era-card__title">{{.Name}}</h2>
                <span class="era-card__dates">{{formatDateRange .StartDate .EndDate}}</span>
            </div>
            
            <div class="era-card__mood-bar"></div>
            
            <div class="era-card__meta">
                {{if .TopTags}}
                <div class="era-card__tags">
                    {{range .TopTags}}
                    <a href="https://www.last.fm/tag/{{.}}" target="_blank" rel="noopener noreferrer" class="tag tag--link">{{.}}</a>
                    {{end}}
                </div>
                {{end}}
                <span class="era-card__track-count">{{.TrackCount}} tracks</span>
            </div>
            
            <div class="era-card__tracks" id="tracks-{{.ID}}">
                <button 
                    class="btn btn-ghost btn-sm"
                    hx-get="/eras/{{.ID}}/tracks"
                    hx-target="#tracks-{{.ID}}"
                    hx-swap="innerHTML"
                    hx-indicator="#loading-{{.ID}}"
                >
                    Show Tracks
                </button>
                <span id="loading-{{.ID}}" class="htmx-indicator">
                    <span class="spinner"></span>
                </span>
            </div>
            
            <div class="era-card__actions">
                {{if .PlaylistID}}
                <a href="https://open.spotify.com/playlist/{{.PlaylistID}}" 
                   target="_blank" 
                   rel="noopener noreferrer"
                   class="btn btn-primary btn-sm">
                    Open Playlist
                </a>
                {{else}}
                <button 
                    class="btn btn-primary btn-sm"
                    hx-post="/eras/{{.ID}}/playlist"
                    hx-swap="outerHTML"
                    disabled
                    title="Coming soon"
                >
                    Create Playlist
                </button>
                {{end}}
            </div>
        </article>
        {{end}}
    </div>
    {{else}}
    <div class="empty-state">
        <div class="empty-state__icon">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <circle cx="12" cy="12" r="10"/>
                <circle cx="12" cy="12" r="3"/>
                <path d="M12 2v4M12 18v4M2 12h4M18 12h4"/>
            </svg>
        </div>
        <h2 class="empty-state__title">No Eras Yet</h2>
        <p class="empty-state__description">
            We haven't analyzed your library yet. Your listening eras will appear here
            once we sync your liked songs and detect patterns.
        </p>
        <div class="empty-state__actions">
            <button 
                class="btn btn-primary"
                hx-post="/api/analyze"
                hx-indicator="#analyze-loading"
                hx-swap="none"
                hx-on::after-request="if(event.detail.successful) window.location.reload()"
            >
                <span class="btn-text">Analyze My Library</span>
                <span id="analyze-loading" class="htmx-indicator">
                    <span class="spinner"></span>
                </span>
            </button>
            <a href="/" class="btn btn-secondary">Go Home</a>
        </div>
    </div>
    {{end}}
</section>
{{end}}

{{define "scripts"}}
<style>
.eras-page {
    max-width: 1200px;
    margin: 0 auto;
    padding: var(--space-xl);
}

.eras-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: var(--space-2xl);
    gap: var(--space-lg);
    flex-wrap: wrap;
}

.eras-header__title {
    font-family: var(--font-display);
    font-size: var(--text-3xl);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-primary);
    margin: 0;
}

.eras-header__subtitle {
    font-family: var(--font-body);
    font-size: var(--text-sm);
    color: var(--text-secondary);
    margin: var(--space-sm) 0 0;
}

.eras-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
    gap: var(--space-xl);
}

.era-card {
    background: linear-gradient(
        135deg,
        rgba(20, 20, 22, 0.9),
        rgba(28, 28, 31, 0.8)
    );
    backdrop-filter: blur(10px);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius-xl);
    padding: var(--space-lg);
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
    transition: box-shadow var(--transition-slow), transform var(--transition-slow), border-color var(--transition-slow);
}

.era-card:hover {
    border-color: var(--accent-secondary);
    box-shadow: 
        0 8px 32px rgba(0, 0, 0, 0.5),
        0 0 40px color-mix(in srgb, var(--accent-secondary) 15%, transparent);
    transform: translateY(-2px);
}

.era-card__header {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    gap: var(--space-md);
    flex-wrap: wrap;
}

.era-card__title {
    font-family: var(--font-display);
    font-size: var(--text-xl);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-primary);
    margin: 0;
}

.era-card__dates {
    font-family: var(--font-body);
    font-size: var(--text-xs);
    color: var(--text-secondary);
    white-space: nowrap;
}

.era-card__mood-bar {
    height: 4px;
    background: var(--mood-gradient);
    border-radius: 2px;
    box-shadow: 0 0 10px color-mix(in srgb, var(--accent-tertiary) 50%, transparent);
}

.era-card__meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: var(--space-md);
    flex-wrap: wrap;
}

.era-card__tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-xs);
}

.tag {
    font-family: var(--font-body);
    font-size: var(--text-xs);
    background: var(--bg-elevated);
    color: var(--text-secondary);
    padding: var(--space-xs) var(--space-sm);
    border-radius: var(--radius-full);
    border: 1px solid var(--border-subtle);
}

.tag--link {
    text-decoration: none;
    transition: border-color var(--transition-fast), color var(--transition-fast);
}

.tag--link:hover {
    border-color: var(--accent-primary);
    color: var(--accent-primary);
}

.era-card__track-count {
    font-family: var(--font-body);
    font-size: var(--text-xs);
    color: var(--text-tertiary);
}

.era-card__tracks {
    min-height: 2.5rem;
    display: flex;
    align-items: center;
    gap: var(--space-sm);
}

.era-card__actions {
    display: flex;
    gap: var(--space-sm);
    margin-top: auto;
}

/* Track list inside era card */
.track-list {
    width: 100%;
    max-height: 300px;
    overflow-y: auto;
    border-radius: var(--radius-md);
    background: var(--bg-deep);
}

.track-item {
    display: grid;
    grid-template-columns: 2rem 1fr;
    gap: var(--space-sm);
    align-items: center;
    padding: var(--space-sm) var(--space-md);
    transition: background var(--transition-fast);
}

.track-item:nth-child(odd) {
    background: rgba(255, 255, 255, 0.02);
}

.track-item:hover {
    background: var(--bg-hover);
}

.track-item__number {
    font-family: var(--font-body);
    font-size: var(--text-xs);
    color: var(--text-tertiary);
    text-align: right;
}

.track-item__info {
    overflow: hidden;
}

.track-item__name {
    font-family: var(--font-body);
    font-size: var(--text-sm);
    color: var(--text-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.track-item__artist {
    font-family: var(--font-body);
    font-size: var(--text-xs);
    color: var(--text-secondary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* Empty state */
.empty-state {
    text-align: center;
    padding: var(--space-3xl) var(--space-xl);
}

.empty-state__icon {
    color: var(--text-tertiary);
    margin-bottom: var(--space-lg);
}

.empty-state__title {
    font-family: var(--font-display);
    font-size: var(--text-2xl);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-primary);
    margin: 0 0 var(--space-md);
}

.empty-state__description {
    font-family: var(--font-body);
    font-size: var(--text-sm);
    color: var(--text-secondary);
    max-width: 400px;
    margin: 0 auto var(--space-xl);
}

.empty-state__actions {
    display: flex;
    gap: var(--space-md);
    justify-content: center;
    flex-wrap: wrap;
}

.btn-text {
    display: inline;
}

.htmx-request .btn-text {
    opacity: 0.7;
}

.btn .htmx-indicator {
    margin-left: var(--space-sm);
}

/* Button variants */
.btn-ghost {
    background: transparent;
    color: var(--text-secondary);
    border: 1px solid var(--border-subtle);
}

.btn-ghost:hover {
    border-color: var(--accent-primary);
    color: var(--accent-primary);
}

.btn-sm {
    font-size: var(--text-xs);
    padding: var(--space-xs) var(--space-sm);
}

/* Loading indicator */
.htmx-indicator {
    display: none;
}

.htmx-request .htmx-indicator {
    display: inline-flex;
}

.htmx-request.htmx-indicator {
    display: inline-flex;
}

.spinner {
    width: 1rem;
    height: 1rem;
    border: 2px solid var(--border-subtle);
    border-top-color: var(--accent-primary);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}
</style>
{{end}}
